# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/models/ — папка с моделями данных

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды:

```bash
npm install
npm run dev
```

или

```bash
yarn
yarn dev
```

## Сборка

```bash
npm run build
```

или

```bash
yarn build
```

---

# Интернет-магазин «Web-Larеk»

«Web-Larеk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме **MVP (Model-View-Presenter)**, которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

- **Model** — слой данных, отвечает за хранение и изменение данных.
- **View** — слой представления, отвечает за отображение данных на странице.
- **Presenter** — презентер содержит основную логику приложения и отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события, используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component

Является базовым классом для всех компонентов интерфейса. Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

**Конструктор:**
- `constructor(container: HTMLElement)` — принимает ссылку на DOM-элемент, за отображение которого он отвечает.

**Поля класса:**
- `container: HTMLElement` — поле для хранения корневого DOM-элемента компонента.

**Методы класса:**
- `render(data?: Partial<T>): HTMLElement` — главный метод класса. Принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент.
- `setImage(element: HTMLImageElement, src: string, alt?: string): void` — утилитарный метод для модификации DOM-элементов `<img>`.

#### Класс Api

Содержит в себе базовую логику отправки запросов.

**Конструктор:**
- `constructor(baseUrl: string, options: RequestInit = {})` — в конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

**Поля класса:**
- `baseUrl: string` — базовый адрес сервера.
- `options: RequestInit` — объект с заголовками, которые будут использованы для запросов.

**Методы:**
- `get<T extends object>(uri: string): Promise<T>` — выполняет GET-запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер.
- `post<T extends object>(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<T>` — принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт, переданный как параметр при вызове метода. По умолчанию выполняется `POST`-запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse<T>(response: Response): Promise<T>` — защищенный метод, проверяющий ответ сервера на корректность и возвращающий объект с данными, полученный от сервера, или отклоненный промис в случае некорректных данных.

#### Класс EventEmitter

Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

**Конструктор:** не принимает параметров.

**Поля класса:**
- `_events: Map<EventName, Set<Subscriber>>` — хранит коллекцию подписок на события. Ключи коллекции — названия событий или регулярное выражение, значения — коллекция функций-обработчиков, которые будут вызваны при срабатывании события.

**Методы класса:**
- `on<T extends object>(eventName: EventName, callback: (event: T) => void): void` — подписка на событие, принимает название события и функцию-обработчик.
- `off(eventName: EventName, callback: Subscriber): void` — снятие обработчика с события.
- `emit<T extends object>(eventName: string, data?: T): void` — инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.
- `onAll(callback: (event: EmitterEvent) => void): void` — слушать все события.
- `offAll(): void` — сбросить все обработчики.
- `trigger<T extends object>(eventName: string, context?: Partial<T>): (data: T) => void` — возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

---

## Типы данных

В приложении используются следующие типы и интерфейсы:

### IProduct

Интерфейс описывает структуру данных товара в каталоге.

```typescript
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

**Поля:**
- `id: string` — уникальный идентификатор товара.
- `description: string` — описание товара.
- `image: string` — путь к изображению товара.
- `title: string` — название товара.
- `category: string` — категория товара.
- `price: number | null` — цена товара (может быть null, если товар бесценный).

### TPayment

Тип определяет допустимые способы оплаты.

```typescript
type TPayment = 'card' | 'cash';
```

**Значения:**
- `'card'` — оплата банковской картой.
- `'cash'` — оплата наличными.

### IBuyer

Интерфейс описывает структуру данных покупателя при оформлении заказа.

```typescript
interface IBuyer {
  payment: TPayment;
  email: string;
  phone: string;
  address: string;
}
```

**Поля:**
- `payment: TPayment` — способ оплаты.
- `email: string` — электронная почта покупателя.
- `phone: string` — телефон покупателя.
- `address: string` — адрес доставки.

### IOrderData

Интерфейс описывает структуру данных для отправки заказа на сервер.

```typescript
interface IOrderData {
  items: string[];
  payment: TPayment;
  email: string;
  phone: string;
  address: string;
}
```

**Поля:**
- `items: string[]` — массив идентификаторов товаров в заказе.
- `payment: TPayment` — способ оплаты.
- `email: string` — электронная почта покупателя.
- `phone: string` — телефон покупателя.
- `address: string` — адрес доставки.

### IOrderResponse

Интерфейс описывает структуру ответа сервера при создании заказа.

```typescript
interface IOrderResponse {
  id: string;
  total: number;
}
```

**Поля:**
- `id: string` — идентификатор созданного заказа.
- `total: number` — общая стоимость заказа.

### IApi

Интерфейс описывает методы для работы с API.

```typescript
interface IApi {
  get<T extends object>(uri: string): Promise<T>;
  post<T extends object>(uri: string, data: object, method?: ApiPostMethods): Promise<T>;
}
```

---

## Модели данных

### Класс Products

**Назначение:** класс для хранения и управления каталогом товаров. Отвечает за хранение всего списка товаров и выбранного товара для детального просмотра.

**Конструктор:**
- `constructor()` — не принимает параметров, инициализирует пустой массив товаров и `null` для выбранного товара.

**Поля класса:**
- `private items: IProduct[]` — хранит массив всех товаров каталога.
- `private selectedProduct: IProduct | null` — хранит товар, выбранный для подробного отображения.

**Методы класса:**
- `setItems(items: IProduct[]): void` — сохраняет массив товаров в модель. Принимает массив товаров типа `IProduct`.
- `getItems(): IProduct[]` — возвращает массив всех товаров из модели.
- `getItem(id: string): IProduct | null` — возвращает товар по его идентификатору или `null`, если товар не найден.
- `setSelectedProduct(product: IProduct): void` — сохраняет товар для подробного отображения.
- `getSelectedProduct(): IProduct | null` — возвращает выбранный товар для отображения или `null`.

---

### Класс Cart

**Назначение:** класс для хранения и управления корзиной покупок. Отвечает за хранение товаров, выбранных покупателем для покупки.

**Конструктор:**
- `constructor()` — не принимает параметров, инициализирует пустой массив товаров.

**Поля класса:**
- `private items: IProduct[]` — хранит массив товаров, добавленных в корзину.

**Методы класса:**
- `getItems(): IProduct[]` — возвращает массив товаров, находящихся в корзине.
- `addItem(product: IProduct): void` — добавляет товар в корзину, если он еще не был добавлен.
- `removeItem(product: IProduct): void` — удаляет товар из корзины.
- `clear(): void` — очищает корзину (удаляет все товары).
- `getTotalPrice(): number` — возвращает общую стоимость всех товаров в корзине.
- `getCount(): number` — возвращает количество товаров в корзине.
- `hasItem(id: string): boolean` — проверяет наличие товара в корзине по его идентификатору.

---

### Класс Buyer

**Назначение:** класс для описания и валидации данных покупателя.

**Конструктор:**
- `constructor()` — не принимает параметров, инициализирует значения по умолчанию.

**Поля класса:**
- `private payment: TPayment` — хранит выбранный способ оплаты.
- `private email: string` — хранит электронную почту покупателя.
- `private phone: string` — хранит телефон покупателя.
- `private address: string` — хранит адрес доставки.

**Методы класса:**
- `setPayment(payment: TPayment): void` — устанавливает способ оплаты.
- `setAddress(address: string): void` — устанавливает адрес доставки.
- `setEmail(email: string): void` — устанавливает электронную почту.
- `setPhone(phone: string): void` — устанавливает телефон.
- `getData(): IBuyer` — возвращает объект со всеми данными покупателя.
- `clear(): void` — очищает все данные покупателя.
- `validate(): IValidationErrors` — выполняет валидацию всех полей, возвращает объект с ошибками (пустой объект, если ошибок нет).

---

## Слой коммуникации

### Класс OrderApi

**Назначение:** класс для взаимодействия с сервером. Использует композицию с классом `Api` для выполнения HTTP-запросов. Отвечает за получение каталога товаров и отправку данных заказа на сервер.

**Конструктор:**
- `constructor(api: IApi)` — принимает экземпляр класса `Api` для выполнения запросов.

**Поля класса:**
- `private api: IApi` — экземпляр класса `Api` для выполнения запросов.

**Методы класса:**
- `getProducts(): Promise<{ items: IProduct[] }>` — выполняет GET-запрос на эндпоинт `/product` и возвращает `Promise` с объектом, содержащим массив товаров.
- `createOrder(data: IOrderData): Promise<IOrderResponse>` — выполняет POST-запрос на эндпоинт `/order` с данными заказа и возвращает `Promise` с ответом сервера (id заказа и общая стоимость).

---

## Структура проекта

```
src/
├── components/
│   ├── base/           # Базовые классы (Component, Api, EventEmitter)
│   └── models/         # Модели данных (Products, Cart, Buyer, OrderApi)
├── types/
│   └── index.ts        # Типы и интерфейсы TypeScript
├── utils/
│   ├── constants.ts    # Константы приложения (API_URL, CDN_URL)
│   ├── data.ts         # Тестовые данные для разработки
│   └── utils.ts        # Вспомогательные утилиты
├── scss/
│   └── styles.scss     # Основные стили приложения
└── main.ts             # Точка входа приложения
```
